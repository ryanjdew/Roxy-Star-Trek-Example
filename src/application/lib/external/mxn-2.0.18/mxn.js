(function(){var providers=null;var modules='core';var scriptBase;var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var match=scripts[i].src.replace(/%20/g,'').match(/^(.*?)mxn\.js(\?\(\[?(.*?)\]?\))?$/);if(match!==null){scriptBase=match[1];if(match[3]){var settings=match[3].split(',[');providers=settings[0].replace(']','');if(settings[1]){modules+=','+settings[1];}}
break;}}
if(providers===null||providers=='none'){return;}
providers=providers.replace(/ /g,'').split(',');modules=modules.replace(/ /g,'').split(',');var scriptTagStart='<script type="text/javascript" src="'+scriptBase+'mxn.';var scriptTagEnd='.js"></script>';var scriptsAry=[];for(i=0;i<modules.length;i++){scriptsAry.push(scriptTagStart+modules[i]+scriptTagEnd);for(var j=0;j<providers.length;j++){scriptsAry.push(scriptTagStart+providers[j]+'.'+modules[i]+scriptTagEnd);}}
document.write(scriptsAry.join(''));})();(function(){var apis={};var invoke=function(sApiId,sObjName,sFnName,oScope,args){if(!hasImplementation(sApiId,sObjName,sFnName)){throw'Method '+sFnName+' of object '+sObjName+' is not supported by API '+sApiId+'. Are you missing a script tag?';}
if(typeof(apis[sApiId][sObjName].deferrable)!='undefined'&&apis[sApiId][sObjName].deferrable[sFnName]===true){mxn.deferUntilLoaded.call(oScope,function(){return apis[sApiId][sObjName][sFnName].apply(oScope,args);});}
else{return apis[sApiId][sObjName][sFnName].apply(oScope,args);}};var hasImplementation=function(sApiId,sObjName,sFnName){if(typeof(apis[sApiId])=='undefined'){throw'API '+sApiId+' not loaded. Are you missing a script tag?';}
if(typeof(apis[sApiId][sObjName])=='undefined'){throw'Object definition '+sObjName+' in API '+sApiId+' not loaded. Are you missing a script tag?';}
return typeof(apis[sApiId][sObjName][sFnName])=='function';};var mxn=window.mxn={register:function(sApiId,oApiImpl){if(!apis.hasOwnProperty(sApiId)){apis[sApiId]={};}
mxn.util.merge(apis[sApiId],oApiImpl);},addProxyMethods:function(func,aryMethods,bWithApiArg){for(var i=0;i<aryMethods.length;i++){var sMethodName=aryMethods[i];if(bWithApiArg){func.prototype[sMethodName]=new Function('return this.invoker.go(\''+sMethodName+'\', arguments, { overrideApi: true } );');}
else{func.prototype[sMethodName]=new Function('return this.invoker.go(\''+sMethodName+'\', arguments);');}}},checkLoad:function(funcDetails){if(this.loaded[this.api]===false){var scope=this;this.onload[this.api].push(function(){funcDetails.callee.apply(scope,funcDetails);});return true;}
return false;},deferUntilLoaded:function(fnCall){if(this.loaded[this.api]===false){var scope=this;this.onload[this.api].push(fnCall);}else{fnCall.call(this);}},addEvents:function(oEvtSrc,aEvtNames){for(var i=0;i<aEvtNames.length;i++){var sEvtName=aEvtNames[i];if(sEvtName in oEvtSrc){throw'Event or method '+sEvtName+' already declared.';}
oEvtSrc[sEvtName]=new mxn.Event(sEvtName,oEvtSrc);}}};mxn.Event=function(sEvtName,oEvtSource){var handlers=[];if(!sEvtName){throw'Event name must be provided';}
this.addHandler=function(fn,ctx){handlers.push({context:ctx,handler:fn});};this.removeHandler=function(fn,ctx){for(var i=0;i<handlers.length;i++){if(handlers[i].handler==fn&&handlers[i].context==ctx){handlers.splice(i,1);}}};this.removeAllHandlers=function(){handlers=[];};this.fire=function(oEvtArgs){var args=[sEvtName,oEvtSource,oEvtArgs];for(var i=0;i<handlers.length;i++){handlers[i].handler.apply(handlers[i].context,args);}};};mxn.Invoker=function(aobj,asClassName,afnApiIdGetter){var obj=aobj;var sClassName=asClassName;var fnApiIdGetter=afnApiIdGetter;var defOpts={overrideApi:false,context:null,fallback:null};this.go=function(sMethodName,args,oOptions){args=typeof(args)!='undefined'?Array.prototype.slice.apply(args):[];if(typeof(oOptions)=='undefined'){oOptions=defOpts;}
var sApiId;if(oOptions.overrideApi){sApiId=args.shift();}
else{sApiId=fnApiIdGetter.apply(obj);}
if(typeof(sApiId)!='string'){throw'API ID not available.';}
if(typeof(oOptions.context)!='undefined'&&oOptions.context!==null){args.push(oOptions.context);}
if(typeof(oOptions.fallback)=='function'&&!hasImplementation(sApiId,sClassName,sMethodName)){return oOptions.fallback.apply(obj,args);}
else{return invoke(sApiId,sClassName,sMethodName,obj,args);}};};mxn.util={merge:function(oRecv,oGive){for(var sPropName in oGive){if(oGive.hasOwnProperty(sPropName)){if(!oRecv.hasOwnProperty(sPropName)||typeof(oRecv[sPropName])!=='object'||typeof(oGive[sPropName])!=='object'){oRecv[sPropName]=oGive[sPropName];}
else{mxn.util.merge(oRecv[sPropName],oGive[sPropName]);}}}},$m:function(){var elements=[];for(var i=0;i<arguments.length;i++){var element=arguments[i];if(typeof(element)=='string'){element=document.getElementById(element);}
if(arguments.length==1){return element;}
elements.push(element);}
return elements;},loadScript:function(src,callback){var script=document.createElement('script');script.type='text/javascript';script.src=src;if(callback){if(script.addEventListener){script.addEventListener('load',callback,true);}
else if(script.attachEvent){var done=false;script.attachEvent("onreadystatechange",function(){if(!done&&document.readyState==="complete"){done=true;callback();}});}}
var h=document.getElementsByTagName('head')[0];h.appendChild(script);return;},convertLatLonXY_Yahoo:function(point,level){var size=1<<(26-level);var pixel_per_degree=size/360.0;var pixel_per_radian=size/(2*Math.PI);var origin=new YCoordPoint(size/2,size/2);var answer=new YCoordPoint();answer.x=Math.floor(origin.x+point.lon*pixel_per_degree);var sin=Math.sin(point.lat*Math.PI/180.0);answer.y=Math.floor(origin.y+0.5*Math.log((1+sin)/(1-sin))*-pixel_per_radian);return answer;},loadStyle:function(href){var link=document.createElement('link');link.type='text/css';link.rel='stylesheet';link.href=href;document.getElementsByTagName('head')[0].appendChild(link);return;},getStyle:function(el,prop){var y;if(el.currentStyle){y=el.currentStyle[prop];}
else if(window.getComputedStyle){y=window.getComputedStyle(el,'').getPropertyValue(prop);}
return y;},lonToMetres:function(lon,lat){return lon*(111200*Math.cos(lat*(Math.PI/180)));},metresToLon:function(m,lat){return m/(111200*Math.cos(lat*(Math.PI/180)));},KMToMiles:function(km){return km/1.609344;},milesToKM:function(miles){return miles*1.609344;},getDegreesFromGoogleZoomLevel:function(pixels,zoom){return(360*pixels)/(Math.pow(2,zoom+8));},getGoogleZoomLevelFromDegrees:function(pixels,degrees){return mxn.util.logN((360*pixels)/degrees,2)-8;},logN:function(number,base){return Math.log(number)/Math.log(base);},getAvailableProviders:function(){var providers=[];for(var propertyName in apis){if(apis.hasOwnProperty(propertyName)){providers.push(propertyName);}}
return providers;},stringFormat:function(strIn){var replaceRegEx=/\{\d+\}/g;var args=Array.prototype.slice.apply(arguments);args.shift();return strIn.replace(replaceRegEx,function(strVal){var num=strVal.slice(1,-1);return args[num];});},traverse:function(start){var args=Array.prototype.slice.apply(arguments);args.shift();var working=start;while(typeof(working)!='undefined'&&working!==null&&args.length>0){var op=args.shift();working=op(working);}}};mxn.util.Color=function(){if(arguments.length==3){this.red=arguments[0];this.green=arguments[1];this.blue=arguments[2];}
else if(arguments.length==1){this.setHexColor(arguments[0]);}};mxn.util.Color.prototype.reHex=/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;mxn.util.Color.prototype.setHexColor=function(strHexColor){var match=strHexColor.match(this.reHex);if(match){strHexColor=match[1];}
else{throw'Invalid HEX color format, expected #000, 000, #000000 or 000000';}
if(strHexColor.length==3){strHexColor=strHexColor.replace(/\w/g,function(str){return str.concat(str);});}
this.red=parseInt(strHexColor.substr(0,2),16);this.green=parseInt(strHexColor.substr(2,2),16);this.blue=parseInt(strHexColor.substr(4,2),16);};mxn.util.Color.prototype.getHexColor=function(){var rgb=this.blue|(this.green<<8)|(this.red<<16);var hexString=rgb.toString(16).toUpperCase();if(hexString.length<6){hexString='0'+hexString;}
return'#'+hexString;};})();
